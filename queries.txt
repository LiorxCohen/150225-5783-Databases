SELECT C.ID, C.Fname, C.Lname, (C.wins / (C.wins + C.losses)) * 100 AS WinPercentage
FROM Coach C
ORDER BY WinPercentage DESC
FETCH FIRST 5 ROWS ONLY;


SELECT P.position, P.Fname, P.Lname, P.birthday
FROM Player P
WHERE P.birthday = (SELECT MIN(birthday) FROM Player WHERE position = P.position)
GROUP BY P.position, P.Fname, P.Lname, P.birthday;


SELECT P.position, AVG(P.height) AS AverageHeight, C.Fname AS CoachFirstName, C.Lname AS CoachLastName, P2.ID, P2.Fname, P2.Lname, P2.awards
FROM Player P
JOIN Coach C ON P.coachID = C.ID
JOIN Player P2 ON P.coachID = P2.coachID
WHERE (C.wins / (C.wins + C.losses)) * 100 > 95
GROUP BY P.position, C.Fname, C.Lname, P2.ID, P2.Fname, P2.Lname, P2.awards
ORDER BY P2.awards DESC
FETCH FIRST 5 ROWS ONLY;


SELECT C.nationality, AVG(C.experience) AS AvgCoachExperience
FROM Coach C
GROUP BY C.nationality;



SELECT P.ID, P.Fname, P.Lname, P.position, C.Fname AS CoachFirstName, C.Lname AS CoachLastName, C.experience
FROM Player P
JOIN Coach C ON P.coachID = C.ID
WHERE C.experience >= 25;


SELECT J.ID, J.Fname AS JudgeFirstName, J.Lname AS JudgeLastName
FROM Judge J
WHERE J.ID IN (
    SELECT J.ID
    FROM Judge J
    JOIN Player P ON J.ID = P.coachID
    GROUP BY J.ID
    HAVING COUNT(DISTINCT P.nationality) >= 3
);


SELECT C.ID AS CoachID, C.Fname AS CoachFirstName, C.Lname AS CoachLastName,
       P.ID AS PlayerID, P.Fname AS PlayerFirstName, P.Lname AS PlayerLastName, P.awards, P.awardYear
FROM Coach C
JOIN Player P ON C.ID = P.coachID
WHERE P.awardYear IN (
    SELECT DISTINCT awardsYear
    FROM Player
    GROUP BY awardsYear
    HAVING COUNT(DISTINCT awards) > 1
);

SELECT C.ID, C.Fname AS CoachFirstName, C.Lname AS CoachLastName, (C.wins / (C.wins + C.losses)) * 100 AS WinPercentage
FROM Coach C
WHERE C.ID IN (
    SELECT coachID
    FROM Player
    GROUP BY coachID
    HAVING COUNT(DISTINCT nationality) >= 3
) AND (C.wins / (C.wins + C.losses)) * 100 > (
    SELECT AVG(wins::float / (wins + losses)) * 100
    FROM Coach
);
